<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BAFS Dojo</title>
    <link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:wght@400;600&family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Bai Jamjuree', 'Noto Sans TC', sans-serif;
            text-align: center;
            background-color: #f3ecd9;
            margin: 0;
            min-height: 100vh;
            position: relative;
            overscroll-behavior: none;
        }
        .start-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding-top: 2rem;
        }
        .start-page h1 {
            font-size: 1.8rem;
            color: #e68434;
            margin-bottom: 1.5rem;
        }
        .start-page .score {
            font-size: 1rem;
            background-color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: inline-block;
        }
        .start-button {
            width: 360px;
            height: 360px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .start-button:hover {
            transform: scale(1.1);
        }
        #chapter-selection-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 20;
            justify-content: center;
            align-items: center;
        }
        #chapter-selection-modal .modal-content {
            background-color: #c93c13;
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            max-width: 80%;
            text-align: center;
            font-size: 1em;
            line-height: 1.5;
        }
        #chapter-selection-modal .modal-content h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        #chapter-selection-modal .chapter-options {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        #chapter-selection-modal .chapter-option {
            width: 100%;
            max-width: 300px;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: #ffffff;
            color: #000000;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            font-size: 1rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #chapter-selection-modal .chapter-option.selected {
            background-color: #ff6902;
            color: #ffffff;
        }
        #chapter-selection-modal .try-luck-button {
            padding: 0.5rem 1rem;
            background-color: #f3ecdc;
            color: #c93c13;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }
        #chapter-selection-modal .try-luck-button:hover {
            background-color: #e0d9c8;
        }
        .game-content {
            display: none;
            max-width: 90%;
            margin: 0 auto;
            padding: 1rem;
            position: relative;
            text-align: center;
            padding-bottom: 2rem;
            cursor: url('https://i.postimg.cc/56XXW9WM/hand-cursor.png') 16 16, pointer;
        }
        .result-page {
            display: none;
            max-width: 90%;
            margin: 0 auto;
            padding: 1rem;
            text-align: center;
        }
        .result-page h1 {
            font-size: 1.5em;
            text-align: center;
            margin: 10px 0;
            color: #e68434;
        }
        .result-page .score {
            font-size: 1rem;
            background-color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
            display: inline-block;
        }
        #results-container {
            display: none;
            width: 100%;
            max-width: 360px;
            margin: 0 auto;
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }
        #correct-answers, #wrong-answers {
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9em;
            flex: 1;
            position: relative;
        }
        #correct-answers h3, #wrong-answers h3 {
            margin: 0 0 5px;
            font-size: 1em;
            margin-right: 30px;
            text-align: left;
        }
        #correct-answers ul, #wrong-answers ul {
            list-style-type: decimal;
            text-align: left;
            padding-left: 20px;
            margin: 0;
        }
        #correct-answers li, #wrong-answers li {
            margin: 3px 0;
            font-size: 0.9em;
        }
        #correct-answers ul {
            list-style-position: outside;
            margin-left: 0;
        }
        #wrong-answers li {
            margin-bottom: 20px;
        }
        #copy-icon, #copy-correct-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            cursor: pointer;
        }
        #copy-feedback, #copy-correct-feedback {
            display: none;
            position: absolute;
            top: 35px;
            right: 10px;
            background-color: #fff;
            color: #333;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.8em;
            border: 1px solid #ccc;
            z-index: 15;
        }
        .what-else-message {
            display: none;
            position: absolute;
            top: 135px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #fff;
            color: #333;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 0.8em;
            border: 1px solid #ccc;
            z-index: 15;
            white-space: nowrap;
        }
        .result-page .back-button {
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background-color: #c93c13;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
        }
        .result-page .back-button:hover {
            background-color: #a53210;
        }
        .end-message {
            font-family: 'Bai Jamjuree', 'Noto Sans TC', sans-serif;
            font-size: 1.5em;
            color: #e68434;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }
        .end-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 50px;
            height: 50px;
            cursor: pointer;
            transition: transform 0.3s ease;
            z-index: 3;
        }
        .end-button:hover {
            transform: scale(1.1);
        }
        .row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        .row.income-statement {
            justify-content: center;
        }
        .row.income-statement.chapter13-mode .cup-container {
            margin: 0.75rem;
        }
        .cup-container {
            position: relative;
            width: 144px;
            height: 144px;
            margin: 0.5rem;
        }
        .cup {
            width: 100%;
            height: 100%;
            background: transparent;
            background-image: url('https://i.postimg.cc/9QhhfXqQ/original-cup.png');
            background-size: cover;
            color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: url('https://i.postimg.cc/56XXW9WM/hand-cursor.png') 16 16, pointer;
            font-size: 0;
            text-align: center;
            position: relative;
            z-index: 2;
        }
        .cup:hover:not(.selected):not(.disappear) {
            background-image: url('https://i.postimg.cc/NfTtY2Fn/toggled-cup.png');
        }
        .cup.selected, .cup.disappear {
            animation: exitEffect 0.5s ease-in-out forwards;
            background-image: url('https://i.postimg.cc/NfTtY2Fn/toggled-cup.png');
        }
        @keyframes exitEffect {
            0% {
                opacity: 1;
                transform: translate(0, 0) rotate(0deg);
            }
            99% {
                opacity: 1;
                transform: translate(51.8px, -190.2px) rotate(40deg);
            }
            100% {
                opacity: 0;
                transform: translate(51.8px, -190.2px) rotate(40deg);
            }
        }
        .reveal-image {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120px;
            height: 120px;
            transform: translate(-50%, -50%);
            display: block;
            opacity: 0;
            z-index: 1;
            transition: opacity 0.2s ease;
        }
        .cup.selected + .reveal-image,
        .cup.disappear + .reveal-image {
            opacity: 1;
        }
        .section-label {
            font-size: 0.9rem;
            color: #333;
            margin-top: 0.5rem;
            text-align: center;
            width: 100%;
        }
        .small-text {
            font-size: 0.9rem;
        }
        .section-label.appropriation {
            line-height: 1.5;
            font-size: 1rem;
        }
        .score-wrapper, .question-wrapper {
            display: block;
            text-align: center;
        }
        .score {
            font-size: 1rem;
            margin-bottom: 0.5rem;
            background-color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: inline-block;
            min-width: 100px;
        }
        .question {
            font-size: 1rem;
            margin-bottom: 1rem;
            background-color: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: inline-block;
            min-width: 200px;
        }
        .feedback {
            font-size: 0.9rem;
            margin-top: 1rem;
        }
        .logo {
            position: fixed;
            bottom: 1rem;
            left: 1rem;
            width: 90px;
            z-index: 10;
            cursor: pointer;
        }
        h1 {
            font-size: 1.2rem;
            text-align: center;
            margin: 0.5rem 0;
            color: #e68434;
        }
        .name-tag-container {
            position: relative;
            margin: 1rem auto;
        }
        .name-tag-container.tag1 {
            width: 300px;
            height: 60px;
        }
        .name-tag-container.tag2 {
            width: 375px;
            height: 60px;
        }
        .name-tag {
            width: 100%;
            height: 100%;
            display: block;
        }
        .name-tag-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: black;
            font-size: 1rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 100%;
        }
        .spacer-row {
            height: 1rem;
        }
        #instruction-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 20;
            justify-content: center;
            align-items: center;
        }
        #instruction-modal .modal-content {
            background-color: #c93c13;
            color: #fff;
            padding: 20px;
            border-radius: 10px;
            max-width: 80%;
            text-align: center;
            font-size: 1em;
            line-height: 1.5;
        }
        #instruction-modal .modal-content p {
            margin: 10px 0;
        }
        #continue-button {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #f3ecdc;
            color: #c93c13;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
        }
        #continue-button:hover {
            background-color: #e0d9c8;
        }
        @media (max-width: 600px) {
            .start-page h1 {
                font-size: 1.5rem;
            }
            .start-page .score {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
            }
            .start-button {
                width: 300px;
                height: 300px;
            }
            .end-button {
                width: 40px;
                height: 40px;
            }
            #chapter-selection-modal .modal-content h2 {
                font-size: 1.3rem;
            }
            #chapter-selection-modal .chapter-option {
                font-size: 0.9rem;
                padding: 0.4rem;
                max-width: 250px;
            }
            .game-content {
                padding: 0.5rem;
                padding-bottom: 2rem;
                cursor: url('https://i.postimg.cc/56XXW9WM/hand-cursor.png') 6 6, pointer;
            }
            .result-page {
                padding-bottom: 90px;
            }
            #results-container {
                flex-direction: column;
                max-width: 300px;
            }
            #correct-answers, #wrong-answers {
                margin: 0 0 10px 0;
                width: 100%;
                height: 115px;
                overflow-y: auto;
            }
            #wrong-answers {
                height: 187px;
            }
            .cup-container {
                width: 54px;
                height: 54px;
                margin: 0.3rem;
            }
            .row.income-statement.chapter13-mode .cup-container {
                margin: 0.5rem;
            }
            .cup {
                width: 54px;
                height: 54px;
                font-size: 0;
                cursor: url('https://i.postimg.cc/56XXW9WM/hand-cursor.png') 6 6, pointer;
            }
            .reveal-image {
                width: 54px;
                height: auto;
            }
            .section-label {
                font-size: 0.7rem;
            }
            .section-label.appropriation {
                font-size: 0.6rem;
                line-height: 1.1;
            }
            .score {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
                min-width: 80px;
            }
            .question {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
                min-width: 150px;
            }
            .feedback {
                font-size: 0.8rem;
            }
            .logo {
                width: 72px;
            }
            h1 {
                font-size: 1rem;
            }
            .name-tag-container.tag1 {
                width: 240px;
                height: 48px;
            }
            .name-tag-container.tag2 {
                width: 300px;
                height: 48px;
            }
            .name-tag-text {
                font-size: 0.8rem;
            }
            .spacer-row {
                height: 0.8rem;
            }
            #copy-feedback, #copy-correct-feedback {
                top: 30px;
                right: 8px;
                font-size: 0.7em;
                padding: 4px 8px;
            }
            .what-else-message {
                top: 45px;
                font-size: 0.7em;
                padding: 4px 8px;
            }
        }
        @media (max-width: 360px) {
            #instruction-modal .modal-content, #chapter-selection-modal .modal-content {
                max-width: 90%;
                padding: 15px;
                font-size: 0.9em;
            }
            #chapter-selection-modal .modal-content h2 {
                font-size: 1.2rem;
            }
            #chapter-selection-modal .chapter-option {
                font-size: 0.8rem;
                padding: 0.3rem;
                max-width: 200px;
            }
            .game-content {
                cursor: url('https://i.postimg.cc/56XXW9WM/hand-cursor.png') 5 5, pointer;
            }
            .cup-container {
                width: 42px;
                height: 42px;
                margin: 0.2rem;
            }
            .row.income-statement.chapter13-mode .cup-container {
                margin: 0.4rem;
            }
            .cup {
                width: 42px;
                height: 42px;
                cursor: url('https://i.postimg.cc/56XXW9WM/hand-cursor.png') 5 5, pointer;
            }
            .reveal-image {
                width: 42px;
                height: auto;
            }
            .section-label {
                font-size: 0.6rem;
            }
            .section-label.appropriation {
                font-size: 0.5rem;
            }
            .name-tag-container.tag1 {
                width: 180px;
                height: 36px;
            }
            .name-tag-container.tag2 {
                width: 225px;
                height: 36px;
            }
            .name-tag-text {
                font-size: 0.7rem;
            }
            #continue-button {
                padding: 8px 15px;
                font-size: 0.9em;
            }
            .spacer-row {
                height: 0.6rem;
            }
            .what-else-message {
                top: 35px;
                font-size: 0.6em;
                padding: 3px 6px;
            }
        }
    </style>
</head>
<body>
    <audio id="background-music" loop>
        <source src="luckgame_bgm.mp3" type="audio/mpeg">
    </audio>
    <audio id="correct">
        <source src="bell_effect.mp3" type="audio/mpeg">
    </audio>
    <audio id="incorrect">
        <source src="shatter_effect.mp3" type="audio/mpeg">
    </audio>

    <div id="chapter-selection-modal">
        <div class="modal-content">
            <h2>What Chapters<br>have you Learned?</h2>
            <div class="chapter-options">
                <div class="chapter-option selected" data-chapter="Chp9">Chp.9 Accruals and Prepayments</div>
                <div class="chapter-option selected" data-chapter="Chp10">Chp.10 Bad Debts and Allowance for Doubtful Accounts</div>
                <div class="chapter-option selected" data-chapter="Chp11">Chp.11 Depreciation</div>
                <div class="chapter-option selected" data-chapter="Chp12">Chp.12 Inventory</div>
                <div class="chapter-option selected" data-chapter="Chp13">Chp.13 Partnership</div>
            </div>
            <button class="try-luck-button">Try my luck!</button>
        </div>
    </div>

    <div id="instruction-modal">
        <div class="modal-content">
            <p id="instruction-text">Welcome to BAFS DOJO!<br>
            Apart from skill, <br> LUCK also plays a crucial role<br> in turning dreams into reality.<br><br>
            Classify accounting items into the <br> correct sections in Financial Statements.<br>
            Flip the right cups to find <br><strong><u>all <span id="total-questions">0</span> Darumas</u></strong>!<br><br>
            Practice makes perfect!<br>
            May LUCK be your faithful companion <br>on every journey you embark on.</p>
            <button id="continue-button">Continue</button>
        </div>
    </div>
    <div class="start-page">
        <h1>May the Force be with You</h1>
        <div class="score">Score: 0 / 0</div>
        <img class="start-button" src="https://i.postimg.cc/cC6cmTND/daruma.png" alt="Start Button">
    </div>
    <div class="game-content">
        <img class="end-button" src="https://i.postimg.cc/gJ2qDd9y/exit.webp" alt="End Game">
        <h1>May the Force be with You</h1>
        <div class="score-wrapper">
            <div class="score" id="score">Score: 0 / 0</div>
        </div>
        <div class="question-wrapper">
            <div class="question" id="question"></div>
        </div>
        <div class="name-tag-container tag1">
            <img class="name-tag" src="https://i.postimg.cc/L4NC1CPF/name-tag.png" alt="Name Tag">
            <div class="name-tag-text">Income Statement</div>
        </div>
        <div class="row income-statement" id="income-statement-row">
            <div class="cup-container">
                <div class="cup" data-section="I/S - Trading"></div>
                <img class="reveal-image" src="" alt="reveal">
                <div class="what-else-message">What may be another answer?</div>
                <div class="section-label">Trading</div>
            </div>
            <div class="cup-container">
                <div class="cup" data-section="I/S - Other Income"></div>
                <img class="reveal-image" src="" alt="reveal">
                <div class="what-else-message">What may be another answer?</div>
                <div class="section-label">P&L - <br> Other Income</div>
            </div>
            <div class="cup-container">
                <div class="cup" data-section="I/S - Other Expenses"></div>
                <img class="reveal-image" src="" alt="reveal">
                <div class="what-else-message">What may be another answer?</div>
                <div class="section-label">P&L - <br> Other Expenses</div>
            </div>
        </div>
        <div class="spacer-row"></div>
        <div class="spacer-row"></div>
        <div class="spacer-row"></div>
        <div class="name-tag-container tag2">
            <img class="name-tag" src="https://i.postimg.cc/L4NC1CPF/name-tag.png" alt="Name Tag">
            <div class="name-tag-text">Statement of Financial Position</div>
        </div>
        <div class="row">
            <div class="cup-container">
                <div class="cup" data-section="SOFP - NCA"></div>
                <img class="reveal-image" src="" alt="reveal">
                <div class="what-else-message">What may be another answer?</div>
                <div class="section-label">NCA</div>
            </div>
            <div class="cup-container">
                <div class="cup" data-section="SOFP - CA"></div>
                <img class="reveal-image" src="" alt="reveal">
                <div class="what-else-message">What may be another answer?</div>
                <div class="section-label">CA</div>
            </div>
            <div class="cup-container">
                <div class="cup" data-section="SOFP - C"></div>
                <img class="reveal-image" src="" alt="reveal">
                <div class="what-else-message">What may be another answer?</div>
                <div class="section-label">C</div>
            </div>
            <div class="cup-container">
                <div class="cup" data-section="SOFP - NCL"></div>
                <img class="reveal-image" src="" alt="reveal">
                <div class="what-else-message">What may be another answer?</div>
                <div class="section-label">NCL</div>
            </div>
            <div class="cup-container">
                <div class="cup" data-section="SOFP - CL"></div>
                <img class="reveal-image" src="" alt="reveal">
                <div class="what-else-message">What may be another answer?</div>
                <div class="section-label">CL</div>
            </div>
        </div>
        <div class="feedback" id="feedback"></div>
    </div>
    <div class="result-page">
        <h1>May the Force be with You</h1>
        <div class="score" id="result-score"></div>
        <div class="end-message" id="end-message"></div>
        <div id="results-container">
            <div id="correct-answers">
                <h3></h3>
                <img id="copy-correct-icon" src="https://i.postimg.cc/fTZLr9yy/copy-grey.png" alt="Copy Correct Answers">
                <div id="copy-correct-feedback" class="copy-feedback">Copied!</div>
                <ul id="correct-answers-list"></ul>
            </div>
            <div id="wrong-answers">
                <h3></h3>
                <img id="copy-icon" src="https://i.postimg.cc/fTZLr9yy/copy-grey.png" alt="Copy Incorrect Answers">
                <div id="copy-feedback" class="copy-feedback">Copied!</div>
                <ul id="wrong-answers-list"></ul>
            </div>
        </div>
        <button class="back-button">Back to Start</button>
    </div>
    <a href="https://www.instagram.com/bafsdojo?igsh=MXhnNW9zN3JjMXJoMg%3D%3D&utm_source=qr" target="_blank">
        <img src="https://i.postimg.cc/0yMN6650/bafs-dojo.jpg" alt="BAFS Logo" class="logo">
    </a>

    <script>
        const originalItems = [
            { name: "Abnormal inventory loss", sections: ["I/S - Trading", "I/S - Other Expenses"], alternateSections: [], chapters: ["Chp12"], multiple: true },
            { name: "Accrued expenses", sections: ["SOFP - CL"], alternateSections: [], chapters: ["Chp9"] },
            { name: "Accrued income", sections: ["SOFP - CA"], alternateSections: [], chapters: ["Chp9"] },
            { name: "Accumulated Depreciation - [NCA]", sections: ["SOFP - NCA"], alternateSections: [], chapters: ["Chp11"] },
            { name: "Administrative expenses", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Advertising", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Allowance for doubtful accounts", sections: ["SOFP - CA"], alternateSections: [], chapters: ["Chp10"] },
            { name: "Allowance for doubtful debts", sections: ["SOFP - CA"], alternateSections: [], chapters: ["Chp10"] },
            { name: "Bad debts", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: ["Chp10"] },
            { name: "Bank", sections: ["SOFP - CA"], alternateSections: [], chapters: [] },
            { name: "Bank charges", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Bank interest income", sections: ["I/S - Other Income"], alternateSections: [], chapters: [] },
            { name: "Bank loan", sections: ["SOFP - NCL"], alternateSections: ["SOFP - CL"], chapters: [] },
            { name: "Bank overdraft", sections: ["SOFP - CL"], alternateSections: [], chapters: [] },
            { name: "Buildings", sections: ["SOFP - NCA"], alternateSections: [], chapters: [] },
            { name: "Capital", sections: ["SOFP - C"], alternateSections: [], chapters: [] },
            { name: "Carriage inwards", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Carriage outwards", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Cash", sections: ["SOFP - CA"], alternateSections: [], chapters: [] },
            { name: "Cleaning", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Commissions expense", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Commissions income", sections: ["I/S - Other Income"], alternateSections: [], chapters: [] },
            { name: "Decrease in bad debts", sections: ["I/S - Other Income"], alternateSections: [], chapters: ["Chp10"] },
            { name: "Deposit from customers (refundable)", sections: ["SOFP - CL"], alternateSections: ["SOFP - NCL"], chapters: [] },
            { name: "Deposit to suppliers (refundable)", sections: ["SOFP - CA"], alternateSections: ["SOFP - NCA"], chapters: [] },
            { name: "Depreciation - [NCA]", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: ["Chp11"] },
            { name: "Discounts allowed", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Discounts received", sections: ["I/S - Other Income"], alternateSections: [], chapters: [] },
            { name: "Drawings (in sole proprietorship)", sections: ["SOFP - C"], alternateSections: [], chapters: [], soleOnly: true },
            { name: "Electricity", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Fixed deposit", sections: ["SOFP - CA"], alternateSections: ["SOFP - NCA"], chapters: [] },
            { name: "Fixtures and fittings", sections: ["SOFP - NCA"], alternateSections: [], chapters: [] },
            { name: "General expenses", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Sundry expenses", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Office expenses", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Miscellaneous expenses", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Heating and lighting", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Insurance", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Insurance compensation receivables", sections: ["SOFP - CA"], alternateSections: [], chapters: ["Chp11", "Chp12"] },
            { name: "Interest on deposit", sections: ["I/S - Other Income"], alternateSections: [], chapters: [] },
            { name: "Interest on [loan from A]", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Interest on [loan to B]", sections: ["I/S - Other Income"], alternateSections: [], chapters: [] },
            { name: "Interest on overdraft", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Internet charges", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Inventory, as at year start", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Inventory, as at year end", sections: ["I/S - Trading", "SOFP - CA"], alternateSections: [], chapters: [], multiple: true },
            { name: "Land", sections: ["SOFP - NCA"], alternateSections: [], chapters: [] },
            { name: "Loan from C", sections: ["SOFP - NCL"], alternateSections: ["SOFP - CL"], chapters: [] },
            { name: "Loan to D", sections: ["SOFP - NCA"], alternateSections: ["SOFP - CA"], chapters: [] },
            { name: "Loan interest expenses", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Long-term investments", sections: ["SOFP - NCA"], alternateSections: [], chapters: [] },
            { name: "Loss on disposal of [NCA]", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: ["Chp11"] },
            { name: "Machinery", sections: ["SOFP - NCA"], alternateSections: [], chapters: [] },
            { name: "Management fees", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Motor expenses", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Motor repairs", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Motor vehicles", sections: ["SOFP - NCA"], alternateSections: [], chapters: [] },
            { name: "Net loss", sections: ["SOFP - C"], soleProprietorshipSection: "SOFP - C", alternateSections: ["I/S - P&L App"], chapters: [], soleOnly: true },
            { name: "Net profit", sections: ["SOFP - C"], soleProprietorshipSection: "SOFP - C", alternateSections: ["I/S - P&L App"], chapters: [], soleOnly: true },
            { name: "New capital contribution", sections: ["SOFP - C"], alternateSections: [], chapters: [], soleOnly: true },
            { name: "Net loss (in partnership)", sections: ["I/S - P&L App"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Net profit (in partnership)", sections: ["I/S - P&L App"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Office equipment", sections: ["SOFP - NCA"], alternateSections: [], chapters: [] },
            { name: "Other payables", sections: ["SOFP - CL"], alternateSections: [], chapters: [] },
            { name: "Other receivables", sections: ["SOFP - CA"], alternateSections: [], chapters: [] },
            { name: "Postages", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Premises", sections: ["SOFP - NCA"], alternateSections: [], chapters: [] },
            { name: "Prepaid expenses", sections: ["SOFP - CA"], alternateSections: [], chapters: ["Chp9"] },
            { name: "Printing and stationery", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Profit on disposal of [NCA]", sections: ["I/S - Other Income"], alternateSections: [], chapters: ["Chp11"] },
            { name: "Purchases", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Purchases returns", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Rent and rates", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Rental deposit from tenants", sections: ["SOFP - CL"], alternateSections: ["SOFP - NCL"], chapters: [] },
            { name: "Rental deposit to landlords", sections: ["SOFP - CA"], alternateSections: ["SOFP - NCA"], chapters: [] },
            { name: "Rental income", sections: ["I/S - Other Income"], alternateSections: [], chapters: [] },
            { name: "Repairs and maintenance", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Returns inwards", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Returns outwards", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Revenue", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Revenue returns", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Sales", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Sales returns", sections: ["I/S - Trading"], alternateSections: [], chapters: [] },
            { name: "Selling and distribution costs", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Short-term investments", sections: ["SOFP - CA"], alternateSections: [], chapters: [] },
            { name: "Staff welfare and entertainment", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Telecommunications", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Telephone", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Time deposit", sections: ["SOFP - CA"], alternateSections: ["SOFP - NCA"], chapters: [] },
            { name: "Trade payables", sections: ["SOFP - CL"], alternateSections: [], chapters: [] },
            { name: "Trade receivables", sections: ["SOFP - CA"], alternateSections: [], chapters: [] },
            { name: "Travelling", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Unearned income", sections: ["SOFP - CL"], alternateSections: [], chapters: ["Chp9"] },
            { name: "Utilities", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Wages and salaries", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Water", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: [] },
            { name: "Term deposit", sections: ["SOFP - CA"], alternateSections: [], chapters: [] },
            { name: "Gain on disposal of [NCA]", sections: ["I/S - Other Income"], alternateSections: [], chapters: ["Chp11"] },
            { name: "Interest on drawings", sections: ["I/S - P&L App"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Interest on capital", sections: ["I/S - P&L App"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Partner's salary", sections: ["I/S - P&L App"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Share of profit", sections: ["I/S - P&L App"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Share of loss", sections: ["I/S - P&L App"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Capital - [Partner]", sections: ["SOFP - C"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Current - [Partner]", sections: ["SOFP - C"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Loan from Partner", sections: ["SOFP - NCL"], alternateSections: [], chapters: ["Chp13"] },
            { name: "Interest on [loan from Partner]", sections: ["I/S - Other Expenses"], alternateSections: [], chapters: ["Chp13"] }
        ];

        const darumaImages = [
            'https://i.postimg.cc/cC6cmTND/daruma.png',
            'https://i.postimg.cc/8F4hd5jd/daruma-black.png',
            'https://i.postimg.cc/ZBq6wSdG/daruma-blue.png',
            'https://i.postimg.cc/JHDZW5KK/daruma-green.png',
            'https://i.postimg.cc/c6rQYdZY/daruma-orange.png',
            'https://i.postimg.cc/ZBDpgMPC/daruma-pink.png',
            'https://i.postimg.cc/YjZQzTqP/daruma-yellow.png'
        ];

        let items = [...originalItems];
        let currentItem;
        let scoreCorrect = 0;
        let totalQuestions = 0;
        let correctAnswers = [];
        let incorrectAnswers = [];
        let totalQuestionCount = 0;
        let usedItems = new Set();
        let clickCount = 0;
        let firstCorrectCup = null;
        const cups = document.querySelectorAll('.cup');
        const questionDiv = document.getElementById('question');
        const feedbackDiv = document.getElementById('feedback');
        const scoreDiv = document.getElementById('score');
        const startPage = document.querySelector('.start-page');
        const chapterSelectionModal = document.getElementById('chapter-selection-modal');
        const gameContent = document.querySelector('.game-content');
        const resultPage = document.querySelector('.result-page');
        const startButton = document.querySelector('.start-button');
        const tryLuckButton = document.querySelector('.try-luck-button');
        const endButton = document.querySelector('.end-button');
        const instructionModal = document.getElementById('instruction-modal');
        const continueButton = document.getElementById('continue-button');
        const backButton = document.querySelector('.back-button');
        const resultsContainer = document.getElementById('results-container');
        const correctAnswersDiv = document.getElementById('correct-answers');
        const correctAnswersList = document.getElementById('correct-answers-list');
        const wrongAnswersDiv = document.getElementById('wrong-answers');
        const wrongAnswersList = document.getElementById('wrong-answers-list');
        const endMessage = document.getElementById('end-message');
        const resultScore = document.getElementById('result-score');
        const copyIcon = document.getElementById('copy-icon');
        const copyFeedback = document.getElementById('copy-feedback');
        const copyCorrectIcon = document.getElementById('copy-correct-icon');
        const copyCorrectFeedback = document.getElementById('copy-correct-feedback');
        const backgroundMusic = document.getElementById('background-music');
        const correctSound = document.getElementById('correct');
        const incorrectSound = document.getElementById('incorrect');
        const incomeStatementRow = document.getElementById('income-statement-row');
        const totalQuestionsSpan = document.getElementById('total-questions');

        backgroundMusic.volume = 0.4;
        correctSound.volume = 1.0;
        incorrectSound.volume = 1.0;

        let chapterSelections = JSON.parse(localStorage.getItem('chapterSelections')) || {
            Chp9: true,
            Chp10: true,
            Chp11: true,
            Chp12: true,
            Chp13: true
        };

        function updateChapterSelections() {
            const options = document.querySelectorAll('.chapter-option');
            options.forEach(option => {
                const chapter = option.dataset.chapter;
                option.classList.toggle('selected', chapterSelections[chapter]);
            });
        }

        updateChapterSelections();

        document.querySelectorAll('.chapter-option').forEach(option => {
            option.addEventListener('click', () => {
                const chapter = option.dataset.chapter;
                chapterSelections[chapter] = !chapterSelections[chapter];
                updateChapterSelections();
            });
        });

        function updateIncomeStatementRow() {
            const existingAppropriation = document.querySelector('[data-section="I/S - P&L App"]');
            if (existingAppropriation) {
                existingAppropriation.parentElement.remove();
            }
            incomeStatementRow.classList.toggle('chapter13-mode', chapterSelections.Chp13);

            if (chapterSelections.Chp13) {
                const cupContainer = document.createElement('div');
                cupContainer.className = 'cup-container';
                cupContainer.innerHTML = `
                    <div class="cup" data-section="I/S - P&L App"></div>
                    <img class="reveal-image" src="" alt="reveal">
                    <div class="what-else-message">What may be another answer?</div>
                    <div class="section-label appropriation"><span class="small-text">P&L - </span><br>Appropriation</div>
                `;
                incomeStatementRow.appendChild(cupContainer);

                const newCup = cupContainer.querySelector('.cup');
                newCup.addEventListener('click', handleCupClick);
            }
        }

        function showResultPage() {
            gameContent.style.display = 'none';
            resultPage.style.display = 'block';
            resultsContainer.style.display = 'flex';
            resultScore.textContent = `Score: ${scoreCorrect} / ${totalQuestions}`;
            const percentage = totalQuestions > 0 ? (scoreCorrect / totalQuestions * 100) : 0;
            if (percentage === 100 && scoreCorrect === totalQuestionCount) {
                endMessage.textContent = "Congrats! You are the luckiest man on earth! 🙇🏻‍♂️";
            } else if (percentage === 100 || percentage >= 90) {
                endMessage.textContent = "You possess almost all the Forces in the universe!";
            } else if (percentage >= 80) {
                endMessage.textContent = "Closer to becoming the luckiest man!";
            } else if (percentage >= 70) {
                endMessage.textContent = "Good job!";
            } else if (percentage >= 50) {
                endMessage.textContent = "Nice Try!";
            } else {
                endMessage.innerHTML = "Sadly, you need more practice. <br>Luck comes with hard work.";
            }
            correctAnswersDiv.querySelector('h3').textContent = `Congrats! You've got ${correctAnswers.length} out of ${totalQuestions} correct!`;
            correctAnswersList.innerHTML = '';
            correctAnswersList.innerHTML = correctAnswers.map(item => `<li>${item.name}: ${item.sections.join(', ')}</li>`).join('');
            if (incorrectAnswers.length === 0) {
                wrongAnswersDiv.querySelector('h3').textContent = "You missed 0. Nailed it!";
                wrongAnswersList.innerHTML = '';
            } else {
                wrongAnswersDiv.querySelector('h3').innerHTML = `You missed ${incorrectAnswers.length}.<br>Can do better next time!`;
                wrongAnswersList.innerHTML = incorrectAnswers.map(item => `
                    <li>
                        <strong>${item.item.name}</strong>:<br>
                        ${item.correctSections.join(', ')}
                    </li>
                `).join('');
            }
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
        }

        function handleCupClick() {
            if (this.style.pointerEvents === 'none') return;

            clickCount++;
            const selectedSection = this.dataset.section;
            const correctSections = currentItem.sections || [];
            const soleProprietorshipSection = currentItem.soleProprietorshipSection;
            const alternateSections = currentItem.alternateSections || [];

            // Handle items with alternate sections (require 2 clicks)
            if (alternateSections.length > 0) {
                if (clickCount === 1) {
                    document.querySelectorAll('.what-else-message').forEach(msg => msg.style.display = 'none');
                    // First click must match soleProprietorshipSection
                    if (soleProprietorshipSection && selectedSection === soleProprietorshipSection) {
                        this.classList.add('selected');
                        const revealImage = this.nextElementSibling;
                        revealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                        revealImage.style.opacity = '1';
                        this.style.pointerEvents = 'none';
                        firstCorrectCup = this;
                        const whatElseMessage = revealImage.nextElementSibling;
                        whatElseMessage.style.display = 'block';
                        document.querySelectorAll('.cup').forEach(cup => {
                            if (cup !== this) {
                                cup.style.pointerEvents = 'auto';
                            }
                        });
                    } else {
                        // First click is incorrect
                        this.classList.add('selected');
                        const revealImage = this.nextElementSibling;
                        revealImage.src = 'https://i.postimg.cc/Wz6s5m6k/monster.png';
                        revealImage.style.opacity = '1';
                        this.style.pointerEvents = 'none';
                        // Reveal soleProprietorshipSection
                        document.querySelectorAll('.cup').forEach(cup => {
                            if (cup.dataset.section === soleProprietorshipSection) {
                                cup.classList.add('disappear');
                                const correctRevealImage = cup.nextElementSibling;
                                correctRevealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                                correctRevealImage.style.opacity = '1';
                                cup.style.pointerEvents = 'none';
                            }
                        });
                        // After 1 second, reveal alternate section
                        setTimeout(() => {
                            document.querySelectorAll('.cup').forEach(cup => {
                                if (alternateSections.includes(cup.dataset.section)) {
                                    cup.classList.add('disappear');
                                    const correctRevealImage = cup.nextElementSibling;
                                    correctRevealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                                    correctRevealImage.style.opacity = '1';
                                    cup.style.pointerEvents = 'none';
                                }
                            });
                        }, 1000);
                        updateScore(false, [soleProprietorshipSection, ...alternateSections]);
                        document.querySelectorAll('.cup').forEach(cup => cup.style.pointerEvents = 'none');
                        setTimeout(setNewQuestion, 2500);
                    }
                } else if (clickCount === 2) {
                    document.querySelectorAll('.what-else-message').forEach(msg => msg.style.display = 'none');
                    const isCorrect = alternateSections.includes(selectedSection) && selectedSection !== firstCorrectCup.dataset.section;

                    if (isCorrect) {
                        // Second click is correct
                        this.classList.add('selected');
                        const revealImage = this.nextElementSibling;
                        revealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                        revealImage.style.opacity = '1';
                        this.style.pointerEvents = 'none';
                        updateScore(true, [soleProprietorshipSection, selectedSection]);
                        document.querySelectorAll('.cup').forEach(cup => cup.style.pointerEvents = 'none');
                        setTimeout(setNewQuestion, 1000);
                    } else {
                        // Second click is incorrect
                        this.classList.add('selected');
                        const revealImage = this.nextElementSibling;
                        revealImage.src = 'https://i.postimg.cc/Wz6s5m6k/monster.png';
                        revealImage.style.opacity = '1';
                        this.style.pointerEvents = 'none';
                        // Reveal the correct alternate section
                        document.querySelectorAll('.cup').forEach(cup => {
                            if (alternateSections.includes(cup.dataset.section)) {
                                cup.classList.add('disappear');
                                const correctRevealImage = cup.nextElementSibling;
                                correctRevealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                                correctRevealImage.style.opacity = '1';
                                cup.style.pointerEvents = 'none';
                            }
                        });
                        updateScore(false, [soleProprietorshipSection, ...alternateSections]);
                        document.querySelectorAll('.cup').forEach(cup => cup.style.pointerEvents = 'none');
                        setTimeout(setNewQuestion, 1500);
                    }
                }
            }
            // Handle items with multiple sections (not alternate)
            else if (currentItem.multiple) {
                if (clickCount === 1) {
                    document.querySelectorAll('.what-else-message').forEach(msg => msg.style.display = 'none');
                    if (correctSections.includes(selectedSection)) {
                        this.classList.add('selected');
                        const revealImage = this.nextElementSibling;
                        revealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                        revealImage.style.opacity = '1';
                        this.style.pointerEvents = 'none';
                        firstCorrectCup = this;
                        const whatElseMessage = revealImage.nextElementSibling;
                        whatElseMessage.style.display = 'block';
                        document.querySelectorAll('.cup').forEach(cup => {
                            if (cup !== this) {
                                cup.style.pointerEvents = 'auto';
                            }
                        });
                    } else {
                        this.classList.add('selected');
                        const revealImage = this.nextElementSibling;
                        revealImage.src = 'https://i.postimg.cc/Wz6s5m6k/monster.png';
                        revealImage.style.opacity = '1';
                        this.style.pointerEvents = 'none';
                        document.querySelectorAll('.cup').forEach(cup => {
                            if (correctSections.includes(cup.dataset.section)) {
                                cup.classList.add('disappear');
                                const correctRevealImage = cup.nextElementSibling;
                                correctRevealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                                correctRevealImage.style.opacity = '1';
                                cup.style.pointerEvents = 'none';
                            }
                        });
                        updateScore(false, correctSections);
                        document.querySelectorAll('.cup').forEach(cup => cup.style.pointerEvents = 'none');
                        setTimeout(setNewQuestion, 1500);
                    }
                } else if (clickCount === 2) {
                    document.querySelectorAll('.what-else-message').forEach(msg => msg.style.display = 'none');
                    const isCorrect = correctSections.includes(selectedSection) && selectedSection !== firstCorrectCup.dataset.section;

                    if (isCorrect) {
                        this.classList.add('selected');
                        const revealImage = this.nextElementSibling;
                        revealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                        revealImage.style.opacity = '1';
                        this.style.pointerEvents = 'none';
                    } else {
                        this.classList.add('selected');
                        const revealImage = this.nextElementSibling;
                        revealImage.src = 'https://i.postimg.cc/Wz6s5m6k/monster.png';
                        revealImage.style.opacity = '1';
                        this.style.pointerEvents = 'none';
                        const remainingCorrectSection = correctSections.find(section => section !== firstCorrectCup.dataset.section);
                        document.querySelectorAll('.cup').forEach(cup => {
                            if (cup.dataset.section === remainingCorrectSection) {
                                cup.classList.add('disappear');
                                const correctRevealImage = cup.nextElementSibling;
                                correctRevealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                                correctRevealImage.style.opacity = '1';
                                cup.style.pointerEvents = 'none';
                            }
                        });
                    }

                    updateScore(isCorrect, correctSections);
                    document.querySelectorAll('.cup').forEach(cup => cup.style.pointerEvents = 'none');
                    setTimeout(setNewQuestion, isCorrect ? 1000 : 1500);
                }
            }
            // Handle single-section items
            else {
                document.querySelectorAll('.what-else-message').forEach(msg => msg.style.display = 'none');
                document.querySelectorAll('.cup').forEach(c => {
                    c.classList.remove('selected');
                    c.classList.remove('disappear');
                });
                this.classList.add('selected');
                const isCorrect = correctSections.includes(selectedSection);

                document.querySelectorAll('.cup').forEach(c => {
                    const revealImage = c.nextElementSibling;
                    if (correctSections.includes(c.dataset.section)) {
                        revealImage.src = darumaImages[Math.floor(Math.random() * darumaImages.length)];
                        revealImage.style.opacity = '1';
                        c.classList.add(c.classList.contains('selected') ? 'selected' : 'disappear');
                        c.style.pointerEvents = 'none';
                    } else if (c.classList.contains('selected')) {
                        revealImage.src = 'https://i.postimg.cc/Wz6s5m6k/monster.png';
                        revealImage.style.opacity = '1';
                        c.style.pointerEvents = 'none';
                    }
                });

                updateScore(isCorrect, correctSections);
                document.querySelectorAll('.cup').forEach(cup => cup.style.pointerEvents = 'none');
                setTimeout(setNewQuestion, isCorrect ? 1000 : 1500);
            }
        }

        async function copyToClipboard(text, feedbackElement) {
            feedbackElement.style.display = 'block';
            setTimeout(() => {
                feedbackElement.style.display = 'none';
            }, 2000);

            if (navigator.clipboard && window.isSecureContext) {
                try {
                    await navigator.clipboard.writeText(text);
                    return;
                } catch (err) {
                    console.warn('Clipboard API failed:', err);
                }
            }

            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            try {
                document.execCommand('copy');
            } catch (err) {
                console.error('Fallback copy failed:', err);
            } finally {
                document.body.removeChild(textarea);
            }
        }

        copyIcon.addEventListener('click', () => {
            const text = incorrectAnswers.length > 0
                ? incorrectAnswers.map(item => `${item.item.name}: ${item.correctSections.join(', ')}`).join('\n')
                : 'No incorrect answers';
            copyToClipboard(text, copyFeedback);
        });

        copyCorrectIcon.addEventListener('click', () => {
            const text = correctAnswers.length > 0
                ? correctAnswers.map(item => `${item.name}: ${item.sections.join(', ')}`).join('\n')
                : 'No correct answers';
            copyToClipboard(text, copyCorrectFeedback);
        });

        startButton.addEventListener('click', () => {
            startPage.style.display = 'none';
            chapterSelectionModal.style.display = 'flex';
            usedItems.clear();
        });

        tryLuckButton.addEventListener('click', () => {
            localStorage.setItem('chapterSelections', JSON.stringify(chapterSelections));

            const selectedChapters = Object.keys(chapterSelections).filter(chp => chapterSelections[chp]);
            totalQuestionCount = originalItems.filter(item => {
                if (item.chapters.length > 0 && !item.chapters.some(chp => selectedChapters.includes(chp))) {
                    return false;
                }
                return item.sections.length > 0;
            }).length;

            totalQuestionsSpan.textContent = totalQuestionCount;
            updateIncomeStatementRow();
            chapterSelectionModal.style.display = 'none';
            instructionModal.style.display = 'flex';
        });

        continueButton.addEventListener('click', () => {
            instructionModal.style.display = 'none';
            gameContent.style.display = 'block';
            backgroundMusic.play().catch(err => console.warn('Background music playback failed:', err));
            setNewQuestion();
        });

        backButton.addEventListener('click', () => {
            resultPage.style.display = 'none';
            startPage.style.display = 'flex';
            gameContent.style.display = 'none';
            resultsContainer.style.display = 'none';
            scoreCorrect = 0;
            totalQuestions = 0;
            correctAnswers = [];
            incorrectAnswers = [];
            scoreDiv.textContent = `Score: 0 / 0`;
            totalQuestionsSpan.textContent = '0';
            feedbackDiv.textContent = '';
            items = [...originalItems];
            correctAnswersList.innerHTML = '';
            wrongAnswersList.innerHTML = '';
            endMessage.textContent = '';
            resultScore.textContent = '';
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
            updateChapterSelections();
            usedItems.clear();
        });

        endButton.addEventListener('click', () => {
            showResultPage();
        });

        function getRandomItem(filteredItems) {
            const availableItems = filteredItems.filter(item => !usedItems.has(item.name));
            if (availableItems.length === 0) return null;
            const index = Math.floor(Math.random() * availableItems.length);
            const item = availableItems[index];
            usedItems.add(item.name);
            return item;
        }

        function setNewQuestion() {
            clickCount = 0;
            firstCorrectCup = null;
            document.querySelectorAll('.what-else-message').forEach(msg => msg.style.display = 'none');

            const selectedChapters = Object.keys(chapterSelections).filter(chp => chapterSelections[chp]);
            let filteredItems = originalItems.filter(item => {
                if (item.chapters.length > 0 && !item.chapters.some(chp => selectedChapters.includes(chp))) {
                    return false;
                }
                return item.sections.length > 0;
            });

            if (filteredItems.length === 0 || usedItems.size >= filteredItems.length) {
                showResultPage();
                return;
            }

            currentItem = getRandomItem(filteredItems);
            if (!currentItem) {
                showResultPage();
                return;
            }
            questionDiv.textContent = currentItem.name;
            document.querySelectorAll('.cup').forEach(cup => {
                cup.classList.remove('selected');
                cup.classList.remove('disappear');
                cup.style.pointerEvents = 'auto';
                cup.style.backgroundImage = "url('https://i.postimg.cc/9QhhfXqQ/original-cup.png')";
                const revealImage = cup.nextElementSibling;
                const isCorrectSection = currentItem.sections.includes(cup.dataset.section) ||
                                        (currentItem.alternateSections && currentItem.alternateSections.includes(cup.dataset.section));
                revealImage.src = isCorrectSection
                    ? darumaImages[Math.floor(Math.random() * darumaImages.length)]
                    : 'https://i.postimg.cc/Wz6s5m6k/monster.png';
                revealImage.style.opacity = '0';
            });
            feedbackDiv.textContent = '';
            endButton.style.pointerEvents = 'auto';
        }

        function updateScore(isCorrect, correctSections) {
            totalQuestions++;
            if (isCorrect) {
                scoreCorrect++;
                correctAnswers.push(currentItem);
                correctSound.play().then(() => {
                    correctSound.currentTime = 0;
                    correctSound.play();
                }).catch(err => console.warn('Correct sound playback failed:', err));
            } else {
                incorrectAnswers.push({ item: currentItem, correctSections: correctSections });
                setTimeout(() => {
                    incorrectSound.play().catch(err => console.warn('Incorrect sound playback failed:', err));
                }, 200);
            }
            scoreDiv.textContent = `Score: ${scoreCorrect} / ${totalQuestions}`;
        }

        cups.forEach(cup => cup.addEventListener('click', handleCupClick));
    </script>
</body>
</html>
